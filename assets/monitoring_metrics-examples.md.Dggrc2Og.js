import{_ as i,c as a,o as e,a2 as t}from"./chunks/framework.DCouvwsE.js";const o=JSON.parse('{"title":"RNode Server Metrics Examples","description":"","frontmatter":{},"headers":[],"relativePath":"monitoring/metrics-examples.md","filePath":"monitoring/metrics-examples.md","lastUpdated":1756472367000}'),n={name:"monitoring/metrics-examples.md"};function l(h,s,p,r,k,d){return e(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="rnode-server-metrics-examples" tabindex="-1">RNode Server Metrics Examples <a class="header-anchor" href="#rnode-server-metrics-examples" aria-label="Permalink to &quot;RNode Server Metrics Examples&quot;">â€‹</a></h1><p>Quick examples of how to use and extend RNode Server metrics.</p><h2 id="ðŸš€-basic-usage" tabindex="-1">ðŸš€ Basic Usage <a class="header-anchor" href="#ðŸš€-basic-usage" aria-label="Permalink to &quot;ðŸš€ Basic Usage&quot;">â€‹</a></h2><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createApp } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;rnode-server&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> app</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createApp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  metrics: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Enable Prometheus metrics</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4546</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Server running with metrics on /metrics&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="ðŸ“Š-available-metrics" tabindex="-1">ðŸ“Š Available Metrics <a class="header-anchor" href="#ðŸ“Š-available-metrics" aria-label="Permalink to &quot;ðŸ“Š Available Metrics&quot;">â€‹</a></h2><h3 id="http-metrics" tabindex="-1">HTTP Metrics <a class="header-anchor" href="#http-metrics" aria-label="Permalink to &quot;HTTP Metrics&quot;">â€‹</a></h3><ul><li><code>http_requests_total</code> - Total request count</li><li><code>http_requests_duration_seconds</code> - Request duration</li><li><code>rnode_server_http_status_total</code> - Status code counts</li></ul><h3 id="system-metrics" tabindex="-1">System Metrics <a class="header-anchor" href="#system-metrics" aria-label="Permalink to &quot;System Metrics&quot;">â€‹</a></h3><ul><li><code>rnode_server_process_cpu_usage_percent</code> - CPU usage</li><li><code>rnode_server_process_memory_kb</code> - Memory usage</li><li><code>rnode_server_uptime_seconds</code> - Server uptime</li></ul><h3 id="business-metrics" tabindex="-1">Business Metrics <a class="header-anchor" href="#business-metrics" aria-label="Permalink to &quot;Business Metrics&quot;">â€‹</a></h3><ul><li><code>rnode_server_cache_hits_total</code> - Cache hits</li><li><code>rnode_server_cache_misses_total</code> - Cache misses</li><li><code>rnode_server_slow_requests_total</code> - Slow requests</li></ul><h2 id="ðŸ”§-custom-metrics" tabindex="-1">ðŸ”§ Custom Metrics <a class="header-anchor" href="#ðŸ”§-custom-metrics" aria-label="Permalink to &quot;ðŸ”§ Custom Metrics&quot;">â€‹</a></h2><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { record_cache_hit, record_cache_miss } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;rnode-server&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Cache middleware</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cacheKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> req.url;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cache.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cacheKey)) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    record_cache_hit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cache.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cacheKey));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  record_cache_miss</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="ðŸ“ˆ-monitoring-queries" tabindex="-1">ðŸ“ˆ Monitoring Queries <a class="header-anchor" href="#ðŸ“ˆ-monitoring-queries" aria-label="Permalink to &quot;ðŸ“ˆ Monitoring Queries&quot;">â€‹</a></h2><h3 id="request-rate" tabindex="-1">Request Rate <a class="header-anchor" href="#request-rate" aria-label="Permalink to &quot;Request Rate&quot;">â€‹</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rate(http_requests_total[5m])</span></span></code></pre></div><h3 id="error-rate" tabindex="-1">Error Rate <a class="header-anchor" href="#error-rate" aria-label="Permalink to &quot;Error Rate&quot;">â€‹</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rate(http_requests_total{</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">status=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">~</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;5..&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}[5m])</span></span></code></pre></div><h3 id="_95th-percentile-response-time" tabindex="-1">95th Percentile Response Time <a class="header-anchor" href="#_95th-percentile-response-time" aria-label="Permalink to &quot;95th Percentile Response Time&quot;">â€‹</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">histogram_quantile(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">95</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, rate(http_requests_duration_seconds_bucket[5m]))</span></span></code></pre></div><h3 id="cache-hit-ratio" tabindex="-1">Cache Hit Ratio <a class="header-anchor" href="#cache-hit-ratio" aria-label="Permalink to &quot;Cache Hit Ratio&quot;">â€‹</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rate(rnode_server_cache_hits_total[5m]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (rate(rnode_server_cache_hits_total[5m]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rate(rnode_server_cache_misses_total[5m]))</span></span></code></pre></div><h2 id="ðŸŽ¯-performance-alerts" tabindex="-1">ðŸŽ¯ Performance Alerts <a class="header-anchor" href="#ðŸŽ¯-performance-alerts" aria-label="Permalink to &quot;ðŸŽ¯ Performance Alerts&quot;">â€‹</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># High error rate</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">expr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">rate(http_requests_total{status=~&quot;5..&quot;}[5m]) &gt; 0.1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Slow requests</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">expr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">rate(rnode_server_slow_requests_total[5m]) &gt; 0.05</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># High CPU usage</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">expr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">rnode_server_process_cpu_usage_percent &gt; 80</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># High memory usage</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">expr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">rnode_server_process_memory_kb &gt; 1048576</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 1GB</span></span></code></pre></div><h2 id="ðŸ“±-quick-test" tabindex="-1">ðŸ“± Quick Test <a class="header-anchor" href="#ðŸ“±-quick-test" aria-label="Permalink to &quot;ðŸ“± Quick Test&quot;">â€‹</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Start server with metrics</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check metrics endpoint</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:4546/metrics</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Generate some load</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ab</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:4546/hello</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check metrics again</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:4546/metrics</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http_requests_total</span></span></code></pre></div>`,26)])])}const E=i(n,[["render",l]]);export{o as __pageData,E as default};
